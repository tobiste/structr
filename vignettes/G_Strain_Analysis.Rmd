---
title: "7. Strain and Vorticity Analysis"
author: "Tobias Stephan"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{7. Strain Analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
editor_options: 
  markdown: 
    wrap: 72
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, warning=FALSE, message=FALSE}
library(structr)
```

Import some R-phi data
```{r data}
data(ramsay)
head(ramsay)
```

Calculate densities in Rf-Phi space:
```{r density}
out <- hypercontour(ramsay, angfmt = "deg", proj = 'rfp')
```


Rf/phi plot
```{r rphi}
image(out$x, out$y, out$z, asp = ifelse(out$proj != 'rfp', 1, NA),
  ylim = c(1, out$rmax),
  xlab = bquote(varphi*' ('*degree*')'), ylab = bquote(R[f]),
  main = out$proj, 
 col = viridis::viridis(50)
 )
contour(out$x, out$y, out$z, add = TRUE, lwd = .5)
points(out$points, col = "grey", pch = 16, cex = .5)
```


Equidistant polar plot:
```{r plot2}
out2 <- hypercontour(ramsay, angfmt = "deg", proj = 'eqd')
 
# calculate some colors
levels <- pretty(range(out2$z, na.rm = TRUE), 20)
cols <- viridis::viridis(n = length(levels) - 1)
 
plot(out2$x, y = out2$y, 'n', xlab = NULL, ylab = NULL, asp = 1, axes = FALSE, ann = FALSE)
graphics::.filled.contour(out2$x, out2$y, out2$z, levels = levels, col = cols)
# points(out2$points, col = "grey", cex = .5)
lines( out2$frame, lwd = 2)
title(main = out2$proj)
```

## Vorticity analysis

The rigid grain net after (Jessup et al. 2007) plots the distribution the 
strain ratio (`R`) of orientation (`phi`) of 
porphyroclast over the theoretical distribution of tailless clasts. The plot estimates 
the critical threshold `Rc` marking the transition between the stable-sink 
position and infinitely rotating porphyroclasts. 
This threshold can be interpreted as the the **mean kinmatic vorticity number**.
Here the `Rc` is estimated using the bootstrap method described in Stephan et al. (2025).

```{r vorticity, message=FALSE, warning=FALSE}
ramsay_shift <- ramsay
ramsay_shift[, 2] <- tectonicr::circular_mean(ramsay[, 2]) - ramsay[, 2] # assuming the mean orientation resembles the foliation

RGN_plot(ramsay, col = 'darkred')
```