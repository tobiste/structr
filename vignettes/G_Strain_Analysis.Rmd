---
title: "7. Strain and Vorticity Analysis"
author: "Tobias Stephan"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{7. Strain Analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
editor_options: 
  markdown: 
    wrap: 72
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
set.seed(20250411)
```

```{r setup, warning=FALSE, message=FALSE}
library(structr)
```

## Strain analysis (fabric analysis)

Import some R-phi data from elliptical strain markers
```{r data}
data(ramsay)
head(ramsay)
```

The mean mean strain ellipse (shape and orientation) of deformed elliptical objects as strain markers can be calculated by using the mean shape matrix and its eigenvalues (Shimamoto and Ikeda, 1976):

```{r mean_strain}
ramsay_mean <- mean_strain_ellipse(r = ramsay[, 1], phi = ramsay[, 2])
print(ramsay_mean)
```
The {structr} algorithm also calculates bootstrapped 95% confidence interval.


To visualize the distribution of the strain values, we can calculate densities in Rf-Phi space and plot them in a **Rf/phi** diagram:
```{r rphi, message=FALSE, warning=FALSE}
#| fig-alt: >
#|    Rf-phi plot
Rphi_plot(r = ramsay[, 1], phi = ramsay[, 2])
```

or in an **Equidistant polar plot**:
```{r plot2}
#| fig.alt: >
#|   R/phi data in polar plot
Rphi_polar_plot(ramsay[, 1], ramsay[, 2], proj = "eqd")
```

## Vorticity analysis

The rigid grain net after (Jessup et al. 2007) plots the distribution the 
strain ratio (`R`) of orientation (`phi`) of 
porphyroclast over the theoretical distribution of tailless clasts. The plot estimates 
the critical threshold `Rc` marking the transition between the stable-sink 
position and infinitely rotating porphyroclasts. 
This threshold can be interpreted as the the **mean kinmatic vorticity number**.
Here the `Rc` is estimated using the bootstrap method described in Stephan et al. (2025).

```{r vorticity, message=FALSE, warning=FALSE}
#| fig.alt: >
#|   Rigid grain net

# assuming the mean orientation resembles the foliation
theta <- tectonicr::circular_mean(ramsay[, 2]) - ramsay[, 2]

RGN_plot(r = ramsay[, 1], theta = theta, col = "#B63679")
title(main = "Rigid Grain Net")
```
