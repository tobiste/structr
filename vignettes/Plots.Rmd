---
title: "Orientation Plots"
author: "Tobias Stephan"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
description: >
  This tutorial introduces the various ways to plot spherical data.
vignette: >
  %\VignetteIndexEntry{Orientation Plots}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
editor_options: 
  markdown: 
    wrap: 72
---

This tutorial shows how to create various orientation plots using the {structr} package, including stereographic and equal-area projections, fabric plots, density plots, and fault plots.

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, warning=FALSE, message=FALSE}
library(structr)
```


Import and convert to spherical objects:
```{r example}
data(example_planes_df)
data(example_lines_df)

planes <- Plane(example_planes_df$dipdir, example_planes_df$dip)
lines <- Line(example_lines_df$trend, example_lines_df$plunge)
```

## Equal-area projection
Lambert equal area, lower hemisphere projection is the default plotting setting.

```{r stereo_earea}
#| fig.alt: >
#|   Diagram showing the equal-area Lambert projection of some example data
stereoplot()
points(lines, col = "#B63679", pch = 19, cex = .5)
points(planes, col = "#000004", pch = 1, cex = .5)

legend("topright", legend = c("Lines", "Planes"), col = c("#B63679", "#000004"), pch = c(19, 1), cex = 1)
title(main = "Example data", sub = "Lambert equal area, lower hemisphere projection")
```

> Points can be added using the `points()` function.


## Stereographic projection

To change to equal angle stereographic, upper hemisphere projection, just set the `earea` argument to `FALSE`, and the `upper.hem` argument to `TRUE`:

```{r stereo_eangle}
#| fig.alt: >
#|   Diagram showing the equal-angle stereographic projection of some example data
stereoplot(earea = FALSE)
points(lines, col = "#B63679", pch = 19, cex = .5, earea = FALSE, upper.hem = TRUE)
points(planes, col = "#000004", pch = 1, cex = .5, earea = FALSE, upper.hem = TRUE)

legend("topright", legend = c("Lines", "Planes"), col = c("#B63679", "#000004"), pch = c(19, 1), cex = 1)
title(main = "Example data", sub = "Equal angle stereographic, upper hemisphere projection")
```

### Great and small circles
Great and small circles can be added using the `lines()` function.

Adding great circles:
```{r stereo_greatcircle}
#| fig.alt: >
#|   Diagram showing greatcircles
stereoplot(guides = FALSE) # turn of guides for better visibility
lines(planes, col = "lightgrey", lty = 1)
points(planes, col = "#000004", pch = 1, cex = .5)
```

To plot a small circle with, e.g., a 10° radius, you need to specify the `ang` argument in `lines()`:
```{r stereo_smallcircle}
#| fig.alt: >
#|   Diagram showing smallcircles
stereoplot(guides = FALSE)
lines(lines[1, ], ang = 10, col = "#B63679", pch = 19, cex = .5)
```


## Fabric plots
The **Eigenvalues** of the orientation tensor describe the shape of the distribution of these vectors, that is who clustered, cylindrical or random these vectors are distributed.

A Fabric plot visualizes the shape of the distribution by plotting the eigenvalues of the orientation tensor.
Three different diagram are provided by {structr}, namely the triangular *Vollmer plot*[^vollmer], the logarithmic biplot (*Woodcock plot*)[^woodcock], and the  Lode parameter vs. natural octahedral strain  diagram (*Hsu plot*)[|^hsu].

[^vollmer]: Vollmer, F. W. (1990). An application of eigenvalue methods to structural domain analysis. Geological Society of America Bulletin, 102, 786–791.

[^woodcock]: Woodcock, N. H. (1977). Specification of fabric shapes using an eigenvalue method. Geological Society of America Bulletin88, 1231–1236. Retrieved from http://pubs.geoscienceworld.org/gsa/gsabulletin/article-pdf/88/9/1231/3418366/i0016-7606-88-9-1231.pdf

[^hsu]: Hsu, T. C. (1966). The characteristics of coaxial and non-coaxial
    strain paths. Journal of Strain Analysis, 1(3), 216–222.
    <https://doi.org/10.1243/03093247V013216>

### Vollmer plot
`vollmer_plot()` creates a triangular plot showing the shape of the orientation distribution (after Vollmer, 1990).

```{r vollmer, message=FALSE,warning=FALSE}
#| fig.alt: >
#|   Diagram showing eigen-vector analysis of some example data plotted in an
#|   triangular plot after Vollmer 1990

vollmer_plot(planes, col = "#000004", pch = 1, cex = 2)
vollmer_plot(lines, add = TRUE, col = "#B63679", pch = 19, cex = 2)
legend("topright", legend = c("Lines", "Planes"), col = c("#B63679", "#000004"), pch = c(19, 1), cex = 1)
```

### Woodcock plot 
`woodcock_plot()` creates a logarithmic biplot showing the shape of the orientation distribution (after Woodcock, 1977).

```{r woodcock, message=FALSE,warning=FALSE}
#| fig.alt: >
#|   Diagram showing eigen-vector analysis of some example data plotted in an
#|   biplot plot after Woodcok 1977

woodcock_plot(planes, col = "#000004", pch = 1, cex = 2)
woodcock_plot(lines, add = TRUE, col = "#B63679", pch = 19, cex = 2)
legend("topright", legend = c("Lines", "Planes"), col = c("#B63679", "#000004"), pch = c(19, 1), cex = 1)
```

### Hsu plot
`hsu_plot()` creates a Lode parameter[^lode] vs. natural octahedral strain[^nadai] diagram showing the shape of the orientation distribution (after Hsu, 1965).

[^nadai]: Nádai, A. (1950). Theory of flow and fracture of solids.
    McGraw-Hill.

[^lode]: Lode, W. (1926). Versuche über den Einfluß der mittleren
    Hauptspannung auf das Fließen der Metalle Eisen. Kupfer und Nickel.
    Zeitschrift Für Physik, 36(11–12), 913–939.
    <https://doi.org/10.1007/BF01400222>

```{r hsu, message=FALSE,warning=FALSE}
#| fig.alt: >
#|   Diagram showing eigen-vector analysis of some example data plotted in a
#|   Hsü plot

hsu_plot(planes, col = "#000004", pch = 1, cex = 2)
hsu_plot(lines, add = TRUE, col = "#B63679", pch = 19, cex = 2)
legend("topright", legend = c("Lines", "Planes"), col = c("#B63679", "#000004"), pch = c(19, 1), cex = 1)
```

## Density plots

**Kamb** contours[^kamb] and densities can be added to an existing projection plot using the `contour` functions. 
Weighted densities can be controlled by the `weights` argument and are useful when the orientation measurements have different accuracies.

[^kamb]: Kamb, W. B. (1959). Ice Petrofabric Observations from Blue Glacier, Washington, in Relation to Theory and Experiment. Journal of Geophysical Research, 54(11).

```{r dens_contour, message=FALSE,warning=FALSE}
#| fig.alt: >
#|   Diagram showing the density distribution some example data plotted in an
#|   equal-area projection
example_planes_df$quality <- ifelse(is.na(example_planes_df$quality), 6, example_planes_df$quality) # replacing NA values with 6
plane_weightings <- 6 / example_planes_df$quality

stereoplot(guides = FALSE)
points(planes, col = "grey", pch = 16, cex = .5)
contour(planes, add = TRUE, density.params = list(weights = plane_weightings))
```

`contour()` adds contour lines, while `contourf()` adds filled contours and `image()` adds a density image (i.e. a dense grid of colored rectangles). See `?contour`, `?contourf`, and `?image` for more information.

```{r dens_filled, message=FALSE,warning=FALSE}
#| fig.alt: >
#|   Diagram showing the density distribution some example data plotted in an
#|   equal-area projection
stereoplot(guides = FALSE)
points(planes, col = "grey", pch = 16, cex = .5)
contourf(planes, add = TRUE, density.params = list(weights = plane_weightings))
```

## Synopsis

Let's create a publication ready synoptical plot for the line and plane orientation data, showing the density distribution, eigenvectors/mean values, and fabric strength.

```{r synops1}
# Minimum eigenvector of plane's orientation tensor:
planes_eigen <- ot_eigen(planes)$vectors
planes_eigen3 <- planes_eigen[3, ]

# Mean and SD of lines
lines_mean <- sph_mean(lines)
lines_sd <- sph_sd(lines)

# Fabric strength
fabric_p <- vollmer(planes)["D"]
fabric_l <- vollmer(lines)["D"]
```

The final plot:
```{r synops, message=FALSE,warning=FALSE}
#| fig.alt: >
#|   Diagram showing the density distribution, eigenvectors and mean values

# two plots side by side
par(mfrow = c(1, 2))

# Planes
stereoplot()
points(planes, col = "grey", pch = 16, cex = .5)
contour(planes, add = TRUE, weights = plane_weightings)
points(planes_eigen3, col = "black", pch = 16)
lines(planes_eigen3, col = "black", pch = 16)
title(
  main = "Planes",
  sub = paste0(
    "N: ", nrow(planes), " | Fabric strength: ", round(fabric_p, 2),
    "\nLambert equal area, lower hemisphere projection"
  )
)

# Lines
stereoplot()
points(lines, col = "grey", pch = 16, cex = .5)
contour(lines, add = TRUE, weights = line_weightings)
points(lines_mean, col = "black", pch = 16)
lines(lines_mean, ang = lines_sd, col = "black")
title(
  main = "Lines",
  sub = paste0(
    "N: ", nrow(lines), " | Fabric strength: ", round(fabric_l, 2),
    "\nLambert equal area, lower hemisphere projection"
  )
)
```

## Fault plots

Fault objects consist of planes (fault plane), lines (e.g. striae), and the sense of movement. There are two ways how these combined features can be visualized, namely the Angelier and the Hoeppener plot.

### Angelier plot
The **Angelier plot** shows all planes as *great circles* and lineations as points (after Angelier, 1984)[^angelier]. Fault striae are plotted as vectors on top of the lineation pointing in the movement direction of the hanging wall. Easy to read in case of homogeneous or small datasets. 

[^angelier]: Angelier, J. Tectonic analysis of fault slip data sets, J. Geophys. Res. 89 (B7), 5835-5848 (1984)


```{r faults1}
#| fig.alt: >
#|   Diagram showing example fault data plotted in an
#|   equal-area projection
f <- Fault(
  c("a" = 120, "b" = 125, "c" = 100),
  c(60, 62, 50),
  c(110, 25, 30),
  c(58, 9, 23),
  c(1, -1, 1)
)

stereoplot(title = "Angelier plot")
angelier(f, col = viridis::magma(nrow(f), end = .9))
```

### Hoeppener plot

The **Hoeppener plot** shows all planes as *poles* while lineations are not shown (after Hoeppener, 1955)[^hoeppener]. Instead, fault striae are plotted as vectors on top of poles pointing in the movement direction of the hanging wall. Useful in case of large or heterogeneous datasets. 

[^hoeppener]: Hoeppener, R. Tektonik im Schiefergebirge. Geol Rundsch 44, 26-58 (1955). https://doi.org/10.1007/BF01802903


```{r faults2}
#| fig.alt: >
#|   Diagram showing example fault data plotted in an
#|   equal-area projection
stereoplot(title = "Hoeppener plot")
hoeppener(f, col = viridis::magma(nrow(f), end = .9), points = FALSE)
```

The `points` argument disables plotting the points at the start of the arrows.


> `fault_plot()` is a wrapper function that allows to switch between Angelier and Hoeppener plot using the `type` argument. See `?fault_plot` for details.

